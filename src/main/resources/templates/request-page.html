<!DOCTYPE html>
<html lang="uk" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–ó–∞—è–≤–∫–∏ –Ω–∞ –æ–±–º—ñ–Ω - UkrLitExchange</title>
    <link th:href="@{/css/header.css}" rel="stylesheet">
    <link th:href="@{/css/footer.css}" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --dark-blue: #2A4F6E;
            --accent-green: #28a745;
            --accent-info: #17a2b8;
            --light-bg: #f8f9fa;
            --card-bg: #ffffff;
            --shadow-light: rgba(0,0,0,0.05);
            --shadow-dark: rgba(0,0,0,0.15);
            --radius: 1rem;
        }

        body {
            background: var(--light-bg);
            font-family: 'Segoe UI', sans-serif;
            color: #333;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        h2.text-center {
            color: var(--dark-blue);
            font-weight: 600;
            margin-bottom: 1.5rem;
        }

        /* –ù–∞–≤—ñ–≥–∞—Ü—ñ–π–Ω—ñ –≤–∫–ª–∞–¥–∫–∏ */
        .nav-tabs .nav-link {
            border-radius: var(--radius);
            margin-right: .5rem;
            padding: .75rem 1.25rem;
            color: var(--dark-blue);
            background: #e9ecef;
            transition: background .3s, color .3s;
        }
        .nav-tabs .nav-link.active {
            background: var(--dark-blue);
            color: #fff;
            box-shadow: 0 4px 12px var(--shadow-light);
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –∑–∞—è–≤–∫–∏ */
        .card {
            background: var(--card-bg);
            border: none;
            border-radius: var(--radius);
            box-shadow: 0 4px 12px var(--shadow-light);
            margin-bottom: 1.5rem;
            transition: transform .3s, box-shadow .3s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 32px var(--shadow-dark);
        }

        .card-header {
            border-top-left-radius: var(--radius);
            border-top-right-radius: var(--radius);
        }

        /* –°–µ–∫—Ü—ñ—ó –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫–∞—Ä—Ç–æ—á–∫–∏ */
        .card-body h5 {
            color: var(--dark-blue);
            font-weight: 600;
        }
        .card-body p {
            margin-bottom: .5rem;
        }
        .badge {
            font-size: .85rem;
        }
        .badge.bg-success { background: var(--accent-green); }
        .badge.bg-info { background: var(--accent-info); color: #fff; }
        .badge.bg-secondary { background: #6c757d; color: #fff; }
        .badge.bg-warning { background: #ffc107; color: #212529; }
        .badge.bg-danger { background: #dc3545; color: #fff; }

        /* –ö–Ω–æ–ø–∫–∏ –¥—ñ–π */
        .btn-sm {
            border-radius: .5rem;
            padding: .4rem .8rem;
        }
        .btn-success { background: var(--accent-green); border: none; }
        .btn-success:hover { background: #218838; }
        .btn-danger { background: #dc3545; border: none; }
        .btn-danger:hover { background: #bb2d3b; }
        .btn-primary { background: var(--dark-blue); border: none; }
        .btn-primary:hover { background: #1f3550; }

        /* –†–æ–∑–¥—ñ–ª—å–Ω–∏–∫–∏ */
        .border-top {
            border-top: 1px solid #e9ecef !important;
        }
        .rounded {
            border-radius: var(--radius) !important;
        }
    </style>
</head>
<body>

<header th:replace="~{fragments/header.html :: header}"></header>

<main class="container py-5">

    <h2 class="mb-4 text-center">–ó–∞—è–≤–∫–∏ –Ω–∞ –æ–±–º—ñ–Ω</h2>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-4" id="orderTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab">
                –û—á—ñ–∫—É—é—Ç—å
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="accepted-tab" data-bs-toggle="tab" data-bs-target="#accepted" type="button" role="tab">
                –ü—Ä–∏–π–Ω—è—Ç—ñ
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="completed-tab" data-bs-toggle="tab" data-bs-target="#completed" type="button" role="tab">
                –ó–∞–≤–µ—Ä—à–µ–Ω—ñ
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="mine-tab" data-bs-toggle="tab" data-bs-target="#mine" type="button" role="tab">
                –ú–æ—ó –∑–∞—è–≤–∫–∏
            </button>
        </li>
    </ul>

    <div class="tab-content">

        <!-- Pending Orders -->
        <div class="tab-pane fade show active" id="pending" role="tabpanel" aria-labelledby="pending-tab">
            <div th:if="${#lists.isEmpty(pendingOrders)}" class="text-center text-muted my-4">
                –ù–µ–º–∞—î –∑–∞—è–≤–æ–∫, —â–æ –æ—á—ñ–∫—É—é—Ç—å –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è.
            </div>

            <div class="row" th:each="request : ${pendingOrders}">
                <div class="col-md-6" th:if="${request.receiver.id == currentUser.id}">
                    <div class="card mb-4 shadow-sm">
                        <div class="card-body">

                            <!-- –ó–∞—è–≤–∫–∞ –≤—ñ–¥ –∫–æ–≥–æ -->
                            <div class="mb-3">
                                <h5 class="card-title">–ó–∞–ø–∏—Ç –≤—ñ–¥: <span th:text="${request.sender.username}">Username</span></h5>
                                <p class="mb-1"><strong>–ú—ñ—Å—Ç–æ:</strong> <span th:text="${request.sender.location}">–õ–æ–∫–∞—Ü—ñ—è</span></p>
                            </div>

                            <!-- –ö–Ω–∏–≥–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ (–æ—Ç—Ä–∏–º—É–≤–∞—á–∞) -->
                            <div class="mb-3 border p-2 rounded bg-light">
                                <h6 class="text-primary">–í–∞—à–∞ –∫–Ω–∏–≥–∞:</h6>
                                <img th:src="${request.receiverBook.photoBookUrl}" class="img-fluid mb-2 rounded" alt="–§–æ—Ç–æ –∫–Ω–∏–≥–∏" style="max-height: 180px;" />
                                <p class="mb-1"><strong>–ù–∞–∑–≤–∞:</strong> <span th:text="${request.receiverBook.title}">–Ω–∞–∑–≤–∞</span></p>
                                <p class="mb-1"><strong>–ê–≤—Ç–æ—Ä:</strong> <span th:text="${request.receiverBook.author}">–∞–≤—Ç–æ—Ä</span></p>
                                <p class="mb-1"><strong>–°—Ç–∞–Ω:</strong> <span th:text="${request.receiverBook.condition}">—Å—Ç–∞–Ω</span></p>
                            </div>

                            <!-- –ö–Ω–∏–≥–∞ –≤—ñ–¥–ø—Ä–∞–≤–Ω–∏–∫–∞ -->
                            <div class="mb-3 border p-2 rounded bg-light"
                                 th:if="${request.dashboard.status.name() == 'EXCHANGE' and request.senderBook != null}">
                                <h6 class="text-success">üì¶ –ö–Ω–∏–≥–∞ –Ω–∞ –æ–±–º—ñ–Ω:</h6>
                                <img th:if="${request.senderBook.photoBookUrl != null}"
                                     th:src="${request.senderBook.photoBookUrl}"
                                     class="img-fluid mb-2 rounded" alt="–§–æ—Ç–æ –∫–Ω–∏–≥–∏" style="max-height: 180px;" />
                                <p class="mb-1"><strong>–ù–∞–∑–≤–∞:</strong> <span th:text="${request.senderBook.title}">–Ω–∞–∑–≤–∞</span></p>
                                <p class="mb-1"><strong>–ê–≤—Ç–æ—Ä:</strong> <span th:text="${request.senderBook.author}">–∞–≤—Ç–æ—Ä</span></p>
                                <p class="mb-1"><strong>–°—Ç–∞–Ω:</strong> <span th:text="${request.senderBook.condition}">—Å—Ç–∞–Ω</span></p>
                            </div>

                            <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ -->
                            <p class="mt-3"><strong>–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:</strong> <span th:text="${request.message}">–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</span></p>
                            <p><strong>–ú–µ—Ç–æ–¥ –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> <span class="badge bg-info text-dark" th:text="${request.deliveryMethod}">–¥–æ—Å—Ç–∞–≤–∫–∞</span></p>
                            <p><strong>–¢–∏–ø –æ–±–º—ñ–Ω—É:</strong> <span class="badge bg-secondary" th:text="${request.dashboard.status}">—Ç–∏–ø</span></p>

                            <!-- –ö–Ω–æ–ø–∫–∏ –¥—ñ—ó -->
                            <div class="mt-4 d-flex gap-2">
                                <form th:action="@{/web/ukr-lit-exchange/request/accept}" method="post">
                                    <input type="hidden" name="requestId" th:value="${request.id}" />
                                    <button class="btn btn-success btn-sm" type="submit">–ü—Ä–∏–π–Ω—è—Ç–∏</button>
                                </form>
                                <form th:action="@{/web/ukr-lit-exchange/request/decline}" method="post">
                                    <input type="hidden" name="requestId" th:value="${request.id}" />
                                    <button class="btn btn-danger btn-sm" type="submit">–í—ñ–¥—Ö–∏–ª–∏—Ç–∏</button>
                                </form>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Accepted Orders -->
        <div class="tab-pane fade" id="accepted" role="tabpanel" aria-labelledby="accepted-tab">
            <div th:if="${#lists.isEmpty(acceptedOrders)}" class="text-center text-muted my-4">
                –ù–µ–º–∞—î –ø—Ä–∏–π–Ω—è—Ç–∏—Ö –∑–∞—è–≤–æ–∫.
            </div>

            <div class="row">
                <div class="col-md-6" th:each="request : ${acceptedOrders}"
                     th:if="${request.receiver?.id == currentUser.id}">
                    <div class="card mb-4 shadow-sm border-success">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0" th:text="${request.receiverBook?.title}">–ù–∞–∑–≤–∞ –∫–Ω–∏–≥–∏</h5>
                        </div>
                        <div class="card-body">
                            <p><strong>–û–±–º—ñ–Ω –Ω–∞:</strong> <span th:text="${request.senderBook?.title}">–ö–Ω–∏–≥–∞ –≤—ñ–¥–ø—Ä–∞–≤–Ω–∏–∫–∞</span></p>
                            <p><strong>–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:</strong> <span th:text="${request.message}">–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</span></p>
                            <p><strong>–°–ø–æ—Å—ñ–± –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> <span th:text="${request.deliveryMethod}">–¥–æ—Å—Ç–∞–≤–∫–∞</span></p>
                            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span class="badge bg-success">–ü—Ä–∏–π–Ω—è—Ç–æ</span></p>

                            <div class="mt-4 border-top pt-3">
                                <h6>üì¨ –ö–æ–Ω—Ç–∞–∫—Ç–∏ –≤—ñ–¥–ø—Ä–∞–≤–Ω–∏–∫–∞:</h6>
                                <ul class="list-unstyled mb-3">
                                    <li><strong>–ü–Ü–ë:</strong> <span th:text="${request.sender.fullName}">–ü–Ü–ë</span></li>
                                    <li><strong>Email:</strong> <a th:href="'mailto:' + ${request.sender.email}" th:text="${request.sender.email}">email</a></li>
                                    <li><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> <span th:text="${request.sender.phoneNumber}">—Ç–µ–ª–µ—Ñ–æ–Ω</span></li>
                                    <li><strong>–õ–æ–∫–∞—Ü—ñ—è:</strong> <span th:text="${request.sender.location}">–ª–æ–∫–∞—Ü—ñ—è</span></li>
                                </ul>

                                <h6>üì¶ –ö–æ–Ω—Ç–∞–∫—Ç–∏ –æ—Ç—Ä–∏–º—É–≤–∞—á–∞:</h6>
                                <ul class="list-unstyled">
                                    <li><strong>–ü–Ü–ë:</strong> <span th:text="${request.receiver.fullName}">–ü–Ü–ë</span></li>
                                    <li><strong>Email:</strong> <a th:href="'mailto:' + ${request.receiver.email}" th:text="${request.receiver.email}">email</a></li>
                                    <li><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> <span th:text="${request.receiver.phoneNumber}">—Ç–µ–ª–µ—Ñ–æ–Ω</span></li>
                                    <li><strong>–õ–æ–∫–∞—Ü—ñ—è:</strong> <span th:text="${request.receiver.location}">–ª–æ–∫–∞—Ü—ñ—è</span></li>
                                </ul>
                            </div>

                            <form th:action="@{/web/ukr-lit-exchange/request/complete}" method="post" class="mt-3">
                                <input type="hidden" name="requestId" th:value="${request.id}" />
                                <button class="btn btn-primary btn-sm w-100" type="submit">–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –æ–±–º—ñ–Ω</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    <!-- --------------------------- Done -------------------->
        <div class="tab-pane fade" id="completed" role="tabpanel" aria-labelledby="completed-tab">
            <div th:if="${#lists.isEmpty(completedOrders)}" class="text-center text-muted my-4">
                –ù–µ–º–∞—î –∑–∞–≤–µ—Ä—à–µ–Ω–∏—Ö –∑–∞—è–≤–æ–∫.
            </div>
            <div class="row">
                <div class="col-md-6" th:each="request : ${completedOrders}"
                     th:if="${request.receiver?.id == currentUser.id or request.sender?.id == currentUser.id}">
                    <div class="card mb-4 shadow-sm border-secondary">
                        <div class="card-header bg-secondary text-white">
                            <h5 class="mb-0" th:text="'–û–±–º—ñ–Ω: ' + ${request.receiverBook?.title}">–û–±–º—ñ–Ω</h5>
                        </div>
                        <div class="card-body">
                            <p><strong>–°—Ç–∞—Ç—É—Å:</strong>
                                <span th:if="${request.requestStatus.name() == 'PRE_COMPLETED'}" class="badge bg-warning">–û—á—ñ–∫—É—î –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è</span>
                                <span th:if="${request.requestStatus.name() == 'COMPLETED'}" class="badge bg-success">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                            </p>

                            <p><strong>–í–∏:</strong>
                                <span th:text="${request.sender?.id == currentUser.id} ? '–í—ñ–¥–ø—Ä–∞–≤–Ω–∏–∫' : '–û—Ç—Ä–∏–º—É–≤–∞—á'">—Ä–æ–ª—å</span>
                            </p>

                            <h6 class="mt-3">üìñ –ö–Ω–∏–≥–∞:</h6>
                            <p><strong>–ù–∞–∑–≤–∞:</strong> <span th:text="${request.receiverBook?.title}">–ù–∞–∑–≤–∞</span></p>
                            <p><strong>–ê–≤—Ç–æ—Ä:</strong> <span th:text="${request.receiverBook?.author}">–ê–≤—Ç–æ—Ä</span></p>

                            <div class="mt-3">
                                <h6>üë§ –ü–∞—Ä—Ç–Ω–µ—Ä –ø–æ –æ–±–º—ñ–Ω—É:</h6>
                                <ul class="list-unstyled">
                                    <li><strong>–Ü–º‚Äô—è:</strong> <span th:text="${request.sender?.id == currentUser.id} ? ${request.receiver.fullName} : ${request.sender.fullName}">–Ü–º'—è</span></li>
                                    <li><strong>Email:</strong> <a th:href="'mailto:' + (${request.sender?.id == currentUser.id} ? ${request.receiver.email} : ${request.sender.email})"
                                                                   th:text="${request.sender?.id == currentUser.id} ? ${request.receiver.email} : ${request.sender.email}">email</a></li>
                                </ul>
                            </div>

                            <p><strong>–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:</strong> <span th:text="${request.message}">–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    <!------------------------ My Sent Orders------------------------------------------->

        <div class="tab-pane fade" id="mine" role="tabpanel" aria-labelledby="mine-tab">
            <div th:if="${#lists.isEmpty(sentOrders)}" class="text-center text-muted my-4">
                –í–∏ —â–µ –Ω–µ –Ω–∞–¥—Å–∏–ª–∞–ª–∏ –∂–æ–¥–Ω–æ—ó –∑–∞—è–≤–∫–∏.
            </div>
            <div class="row" th:each="request : ${sentOrders}">
                <div class="col-md-6">
                    <div class="card mb-4 shadow-sm">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0"
                                th:text="${request.dashboard.status.name() == 'DONATION'} ? '–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è' : '–í–∞—à–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ –æ–±–º—ñ–Ω'">
                                –í–∞—à–∞ –∑–∞—è–≤–∫–∞
                            </h5>
                        </div>
                        <div class="card-body">

                            <div class="mb-3" th:if="${request.receiverBook != null}">
                                <h6>üéØ –í–∏ —Ö–æ—á–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏:</h6>
                                <img th:if="${request.receiverBook.photoBookUrl != null}"
                                     th:src="@{${request.receiverBook.photoBookUrl}}"
                                     class="img-fluid rounded mb-2" alt="–§–æ—Ç–æ –∫–Ω–∏–≥–∏" style="max-height: 180px;"/>
                                <p><strong>–ö–Ω–∏–≥–∞:</strong> <span th:text="${request.receiverBook.title}">–ù–∞–∑–≤–∞ –∫–Ω–∏–≥–∏</span></p>
                                <p><strong>–ê–≤—Ç–æ—Ä:</strong> <span th:text="${request.receiverBook.author}">–ê–≤—Ç–æ—Ä</span></p>
                                <p><strong>–ú–æ–≤–∞:</strong> <span th:text="${request.receiverBook.language}">–ú–æ–≤–∞</span></p>
                                <p><strong>–°—Ç–∞–Ω:</strong> <span th:text="${request.receiverBook.condition}">–°—Ç–∞–Ω</span></p>
                            </div>

                            <div class="mb-3 border-top pt-3" th:if="${request.senderBook != null}">
                                <h6>üì¶ –í–∏ –∑–∞–ø—Ä–æ–ø–æ–Ω—É–≤–∞–ª–∏:</h6>
                                <p><strong>–ö–Ω–∏–≥–∞:</strong> <span th:text="${request.senderBook.title}">–ù–∞–∑–≤–∞</span></p>
                                <p><strong>–ê–≤—Ç–æ—Ä:</strong> <span th:text="${request.senderBook.author}">–ê–≤—Ç–æ—Ä</span></p>
                                <p><strong>–ú–æ–≤–∞:</strong> <span th:text="${request.senderBook.language}">–ú–æ–≤–∞</span></p>
                                <p><strong>–°—Ç–∞–Ω:</strong> <span th:text="${request.senderBook.condition}">–°—Ç–∞–Ω</span></p>
                            </div>
                                <br/>
                            <p><strong>–û—Ç—Ä–∏–º—É–≤–∞—á:</strong> <span th:text="${request.receiver?.username}">–æ—Ç—Ä–∏–º—É–≤–∞—á</span></p>
                            <p><strong>–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:</strong> <span th:text="${request.message}">–ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</span></p>

                            <p><strong>–°—Ç–∞—Ç—É—Å:</strong>
                                <span th:if="${request.requestStatus.name() == 'PENDING'}" class="badge bg-warning">–û—á—ñ–∫—É—î</span>
                                <span th:if="${request.requestStatus.name() == 'ACCEPTED'}" class="badge bg-success">–ü—Ä–∏–π–Ω—è—Ç–æ</span>
                                <span th:if="${request.requestStatus.name() == 'DECLINE'}" class="badge bg-danger">–í—ñ–¥—Ö–∏–ª–µ–Ω–æ</span>
                                <span th:if="${request.requestStatus.name() == 'COMPLETED'}" class="badge bg-secondary">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</span>
                            </p>

                            <div th:if="${request.requestStatus.name() == 'ACCEPTED'}" class="mt-3 border-top pt-3">
                                <h6>üìû –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –æ—Ç—Ä–∏–º—É–≤–∞—á–∞:</h6>
                                <p><strong>–Ü–º'—è:</strong>
                                    <span th:text="${request.receiver?.fullName != null ? request.receiver.fullName : request.receiver?.username}">–Ü–º‚Äô—è</span>
                                </p>
                                <p><strong>Email:</strong> <span th:text="${request.receiver?.email}">email</span></p>
                                <p th:if="${request.receiver?.phoneNumber != null}">
                                    <strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> <span th:text="${request.receiver.phoneNumber}">—Ç–µ–ª–µ—Ñ–æ–Ω</span>
                                </p>
                            </div>

                            <div class="mt-3 d-flex gap-2">
                                <form th:if="${request.requestStatus.name() == 'PENDING' || request.requestStatus.name() == 'DECLINE'}"
                                      th:action="@{/web/ukr-lit-exchange/request/cancel}" method="post">
                                    <input type="hidden" name="requestId" th:value="${request.id}" />
                                    <button class="btn btn-outline-danger btn-sm w-100" type="submit">–°–∫–∞—Å—É–≤–∞—Ç–∏ –∑–∞—è–≤–∫—É</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

</main>

<footer th:replace="~{fragments/footer.html :: footer}"></footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
